!!! transitional
%html
  %head
    %title= @title || 'Edit-Fu'
    %meta{ 'http-equiv' => 'Content-Type', :content => 'text/html; charset=UTF-8' }

    = stylesheet_link_tag 'reset', 'layout', 'messages', 'source_bar', 'system_bar', 'action_window', 'action_bar'
    = stylesheet_link_tag 'input', 'popups/popup', 'popups/owner-preferences-popup', 'popups/alert-popup'
    = stylesheet_links

    = javascript_include_tag :defaults, 'tree', 'upload', 'css', 'indents'
    = javascript_includes

  %body
    #all
      #system-bar
        = yield :tabs
        .center
          .logo
            - if current_user.identity.present?
              = link_to current_user.identity, root_path, :class => 'company'
            - else
              = link_to "", root_path, :class => 'editfu'
            - owner? do
              = link_to_remote "Change branding", |
                :url => identity_path, :method => :get, :html => { :class => 'change-branding' } |

        = link_to 'Logout', destroy_user_session_path, :class => 'system-link', :id => 'logout'
        - unless current_user.admin?
          - link_to help_path, :class => 'system-link', :alt => 'Help', :target => '_blank' do
            %img(src='/images/help.png')
        - if user_signed_in?
          = link_to_remote image_tag("preferences.png", :alt => 'Preferences'), | 
            :url => pref_path, | 
            :method => :get, :html => { :class => 'system-link' } |

      #source-bar
        = yield :sourceBar

      #action-window
        #main
          -if @title && @hint
            .header
              %span.title= @title
              %span.actions
                = yield :actions
              .hint= @hint
          = yield
          .clear

      #action-bar
      
      #popup-system{:style => (@content_for_popup ? nil : 'display: none;')}
        .popup#popup
          = yield :popup
        .popup-hider#popup-hider

    = render 'layouts/message'

    #confirm-popup(style='display: none;')
      .confirm-popup.alert-popup
        %h1 Confirmation
        .text Are you sure?

        .popup-action-bar
          = link_to_function "Cancel", "hidePopup();", :class => 'action cancel'
          = link_to 'Remove', '#', :method => :delete, :class => 'action yes'
